# AIDEV-NOTE: 250903170024 Production Redis configuration
# Optimized for performance, security, and persistence

# AIDEV-NOTE: Basic server configuration
port 6379
bind 0.0.0.0
protected-mode yes
tcp-backlog 511
timeout 300
tcp-keepalive 300

# AIDEV-NOTE: Security settings
# requirepass will be set via environment variable
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command DEBUG ""

# AIDEV-NOTE: Memory management
maxmemory 512mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# AIDEV-NOTE: Persistence configuration (RDB + AOF)
# RDB snapshots
save 900 1      # Save if at least 1 key changed in 900 seconds
save 300 10     # Save if at least 10 keys changed in 300 seconds  
save 60 10000   # Save if at least 10000 keys changed in 60 seconds

stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb

# AOF (Append Only File) for better persistence
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes

# AIDEV-NOTE: Logging
loglevel notice
logfile "/var/log/redis/redis-server.log"
syslog-enabled no

# AIDEV-NOTE: Client management
maxclients 10000

# AIDEV-NOTE: Performance tuning
hz 10
dynamic-hz yes

# AIDEV-NOTE: Network tuning
tcp-keepalive 300
timeout 300

# AIDEV-NOTE: Slow log for performance monitoring
slowlog-log-slower-than 10000
slowlog-max-len 128

# AIDEV-NOTE: Latency monitoring
latency-monitor-threshold 100

# AIDEV-NOTE: Advanced features
notify-keyspace-events Ex  # Enable expired key notifications

# AIDEV-NOTE: Directory for data files
dir /data

# AIDEV-NOTE: Database count (default 16 is fine for most use cases)
databases 16